import streamlit as st
import yfinance as yf

# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏ö‡∏ö‡∏Å‡∏ß‡πâ‡∏≤‡∏á
st.set_page_config(page_title="Pro AI Lotto Analytics", layout="wide")

st.title("üèÜ Pro AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏∏‡πâ‡∏ô & ‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏Ç‡πÄ‡∏ô‡πâ‡∏ô 30 ‡∏ä‡∏∏‡∏î")
st.write("‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤ Real-time > ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏±‡∏Å‡∏´‡∏•‡∏±‡∏Å 64 ‡∏ä‡∏∏‡∏î > ‡∏Ñ‡∏±‡∏î‡πÄ‡∏ô‡πâ‡∏ô 30 ‡∏ä‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏á")

# ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î‡∏´‡∏∏‡πâ‡∏ô
market_list = {
    "‡∏ô‡∏¥‡πÄ‡∏Ñ‡∏≠‡∏¥ (‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô)": "^N225", 
    "‡∏Æ‡∏±‡πà‡∏á‡πÄ‡∏™‡πá‡∏á (‡∏Æ‡πà‡∏≠‡∏á‡∏Å‡∏á)": "^HSI", 
    "‡∏´‡∏∏‡πâ‡∏ô‡πÑ‡∏ó‡∏¢ (SET)": "^SET.BK", 
    "‡∏î‡∏≤‡∏ß‡πÇ‡∏à‡∏ô‡∏™‡πå (USA)": "^DJI",
    "‡∏´‡∏∏‡πâ‡∏ô‡∏à‡∏µ‡∏ô (SSE)": "000001.SS",
    "‡∏™‡∏¥‡∏á‡∏Ñ‡πÇ‡∏õ‡∏£‡πå (STI)": "^STI",
    "‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© (FTSE)": "^FTSE",
    "‡πÄ‡∏¢‡∏≠‡∏£‡∏°‡∏±‡∏ô (DAX)": "^GDAXI"
}
choice = st.selectbox("üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏•‡∏≤‡∏î‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:", list(market_list.keys()))

if st.button("ü™Ñ ‡∏™‡∏±‡πà‡∏á AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏Ç‡πÄ‡∏ô‡πâ‡∏ô"):
    try:
        with st.spinner('AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç...'):
            ticker = yf.Ticker(market_list[choice])
            price_data = ticker.history(period="2d")
            
            if not price_data.empty:
                current_price = price_data['Close'].iloc[-1]
                st.metric(label=f"üìä ‡∏£‡∏≤‡∏Ñ‡∏≤ {choice} ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î", value=f"{current_price:,.2f}")
                
                # --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: AI ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏•‡∏Ç‡∏õ‡∏±‡∏Å‡∏´‡∏•‡∏±‡∏Å 8x8 (64 ‡∏ä‡∏∏‡∏î) ---
                # ‡∏™‡∏π‡∏ï‡∏£: ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡∏´‡∏•‡∏±‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ç‡∏≠‡∏á‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏° (Seed)
                price_str = f"{current_price:.2f}"
                seed = int(price_str.split('.')[-1][1]) # ‡∏î‡∏∂‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà 2
                
                tens_list = [(seed + i) % 10 for i in range(8)]
                units_list = [0, 1, 2, 4, 5, 6, 7, 9] # ‡∏™‡∏π‡∏ï‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
                
                all_64 = [f"{t}{u}" for t in tens_list for u in units_list]
                
                # --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: AI ‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏Ç‡πÄ‡∏ô‡πâ‡∏ô 30 ‡∏ï‡∏±‡∏ß (Filtering) ---
                # ‡∏™‡∏π‡∏ï‡∏£: ‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏Ç‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                prime_seed = int(price_str.split('.')[-1][0])
                highlights = []
                for num in all_64:
                    # ‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏£‡∏ß‡∏°‡πÄ‡∏•‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£ AI)
                    if (int(num[0]) + int(num[1])) % 10 in [prime_seed, (prime_seed+1)%10, (prime_seed+2)%10]:
                        highlights.append(num)
                
                # ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ 30 ‡∏ï‡∏±‡∏ß‡∏û‡∏≠‡∏î‡∏µ (‡∏ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏î‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏° ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏±‡∏î‡∏≠‡∏≠‡∏Å)
                highlights = highlights[:30] if len(highlights) >= 30 else (highlights + [x for x in all_64 if x not in highlights])[:30]
                highlights.sort()

                # --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ---
                
                # 1. ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç‡πÄ‡∏ô‡πâ‡∏ô 30 ‡∏ï‡∏±‡∏ß (‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏á)
                st.subheader("üî• AI ‡∏Ñ‡∏±‡∏î‡πÄ‡∏ô‡πâ‡∏ô 30 ‡∏ä‡∏∏‡∏î (‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏á)")
                st.info(f"‡πÄ‡∏•‡∏Ç‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏°‡∏≤‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤ {current_price:.2f}")
                
                # ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡πÅ‡∏ñ‡∏ß‡∏•‡∏∞ 10 ‡∏ï‡∏±‡∏ß ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏Ç‡πÄ‡∏ô‡πâ‡∏ô
                for i in range(0, len(highlights), 10):
                    row = highlights[i:i+10]
                    st.code("  ".join([f"{n}," for n in row]))

                st.divider()

                # 2. ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 64 ‡∏ä‡∏∏‡∏î (‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß)
                st.subheader("üìã ‡∏ä‡∏∏‡∏î‡πÄ‡∏ï‡πá‡∏° 64 ‡∏´‡∏≤‡∏á (‡∏õ‡∏±‡∏Å‡∏´‡∏•‡∏±‡∏Å 8x8)")
                html_code = '<table style="width:100%; border-collapse: collapse;">'
                for i in range(0, len(all_64), 8):
                    row_items = all_64[i:i+8]
                    html_code += '<tr>'
                    for item in row_items:
                        # ‡πÉ‡∏™‡πà‡∏™‡∏µ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° 30 ‡∏ï‡∏±‡∏ß‡∏î‡πâ‡∏ß‡∏¢
                        bg_color = "#FFE0B2" if item in highlights else "#FFFFFF"
                        html_code += f'<td style="border: 1px solid #ddd; padding: 10px; text-align: center; font-family: monospace; background-color: {bg_color}; font-size: 18px;">{item},</td>'
                    html_code += '</tr>'
                html_code += '</table>'
                st.markdown(html_code, unsafe_allow_html=True)
                
                st.caption("üí° ‡∏™‡∏µ‡∏™‡πâ‡∏°‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á = ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° '‡∏Ñ‡∏±‡∏î‡πÄ‡∏ô‡πâ‡∏ô 30 ‡∏ä‡∏∏‡∏î'")
            else:
                st.error("‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
                
    except Exception as e:
        st.error(f"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: {e}")
