import streamlit as st
import yfinance as yf
import re
import pandas as pd
from collections import Counter

# 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
st.set_page_config(page_title="AI Lotto 65-Tail Pro", layout="wide")

# 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ä‡∏∏‡∏î‡πÄ‡∏•‡∏Ç
def display_table(res, highlights, color="#D1C4E9"):
    html_code = f'<table style="width:100%; border-collapse: collapse;">'
    for i in range(0, len(res), 8):
        row_items = res[i:i+8]
        html_code += '<tr>'
        for item in row_items:
            bg_color = color if item in highlights else "#FFFFFF"
            html_code += f'<td style="border: 1px solid #ddd; padding: 12px; text-align: center; font-family: monospace; background-color: {bg_color}; font-size: 18px; font-weight: bold;">{item},</td>'
        html_code += '</tr>'
    html_code += '</table>'
    st.markdown(html_code, unsafe_allow_html=True)

# 3. ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å
st.sidebar.title("üöÄ AI Lotto Menu")
mode = st.sidebar.radio("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î:", ["üéØ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏¢‡∏µ‡πà‡∏Å‡∏µ 65 ‡∏´‡∏≤‡∏á", "üìà ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏∏‡πâ‡∏ô"])

if mode == "üéØ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏¢‡∏µ‡πà‡∏Å‡∏µ 65 ‡∏´‡∏≤‡∏á":
    st.title("üéØ AI ‡∏¢‡∏µ‡πà‡∏Å‡∏µ‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏ô‡πâ‡∏ô‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì (65-72 ‡∏´‡∏≤‡∏á) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ñ‡∏π‡∏Å‡∏™‡∏π‡∏á")
    
    raw_input = st.text_area("‡∏ß‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏¢‡∏µ‡πà‡∏Å‡∏µ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ 20-40 ‡∏£‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î):", height=200, placeholder="‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢...")
    target = st.radio("üìç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô:", ["‡∏ö‡∏ô (2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô)", "‡∏•‡πà‡∏≤‡∏á (2 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á)"], horizontal=True)

    if raw_input:
        # ‡∏î‡∏∂‡∏á‡πÄ‡∏•‡∏Ç‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏¢‡∏µ‡πà‡∏Å‡∏µ‡∏ó‡∏±‡∏ô‡πÉ‡∏à)
        tops = re.findall(r"‡∏ö‡∏ô\s*(\d+)", raw_input.replace("‡∏™‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏ö‡∏ô", "‡∏ö‡∏ô"))
        bots = re.findall(r"‡∏•‡πà‡∏≤‡∏á\s*(\d+)", raw_input.replace("‡∏™‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á", "‡∏•‡πà‡∏≤‡∏á"))
        
        if tops and bots:
            st.success(f"üìä ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÑ‡∏î‡πâ {len(tops)} ‡∏£‡∏≠‡∏ö")
            
            # ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            if "‡∏ö‡∏ô" in target:
                pairs = [t[-2:] for t in tops if len(t)>=2]
            else:
                pairs = bots

            # ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏¢‡∏Å‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏•‡∏∞ ‡πÅ‡∏ï‡πâ‡∏°‡∏£‡∏ß‡∏°
            tens = [p[0] for p in pairs]
            units = [p[1] for p in pairs]
            sums = [(int(p[0]) + int(p[1])) % 10 for p in pairs] # ‡πÅ‡∏ï‡πâ‡∏°‡∏£‡∏ß‡∏°

            # ‡∏î‡∏∂‡∏á‡πÄ‡∏î‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏∏‡∏ì: ‡∏™‡∏¥‡∏ö 9 ‡∏ï‡∏±‡∏ß / ‡∏´‡∏ô‡πà‡∏ß‡∏¢ 8 ‡∏ï‡∏±‡∏ß
            hot_tens = [i[0] for i in Counter(tens).most_common(9)]
            hot_units = [i[0] for i in Counter(units).most_common(8)]
            hot_sums = [i[0] for i in Counter(sums).most_common(5)] # ‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢‡∏™‡∏∏‡∏î 5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö

            if st.button("üîÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏π‡∏ï‡∏£ 65 ‡∏´‡∏≤‡∏á + ‡∏ï‡∏±‡∏î‡πÅ‡∏ï‡πâ‡∏°"):
                # ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πà‡∏ô‡∏õ‡∏±‡∏Å‡∏´‡∏•‡∏±‡∏Å
                st.subheader("‚úÖ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πà‡∏ô‡∏õ‡∏±‡∏Å‡∏´‡∏•‡∏±‡∏Å")
                col1, col2, col3 = st.columns(3)
                col1.metric("‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏¥‡∏ö (9 ‡∏ï‡∏±‡∏ß)", f"{', '.join(hot_tens)}")
                col2.metric("‡∏´‡∏•‡∏±‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢ (8 ‡∏ï‡∏±‡∏ß)", f"{', '.join(hot_units)}")
                col3.metric("‡πÅ‡∏ï‡πâ‡∏°‡∏Æ‡∏¥‡∏ï", f"{', '.join(map(str, hot_sums))}")

                # ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÄ‡∏•‡∏Ç‡∏ä‡∏∏‡∏î (65-72 ‡∏ä‡∏∏‡∏î)
                all_sets = [f"{t}{u}" for t in hot_tens for u in hot_units]
                
                # ‡∏Ñ‡∏±‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏ô‡πâ‡∏ô (Highlights) ‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°‡∏Æ‡∏¥‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢‡πÉ‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏à‡∏£‡∏¥‡∏á
                highlights = [p for p in all_sets if (int(p[0]) + int(p[1])) % 10 in hot_sums or p in [i[0] for i in Counter(pairs).most_common(15)]]

                st.subheader(f"üìã ‡∏ä‡∏∏‡∏î‡πÄ‡∏•‡∏Ç {len(all_sets)} ‡∏´‡∏≤‡∏á (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)")
                display_table(all_sets, highlights, color="#E8F5E9")
                
                # ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏î‡∏¥‡∏°
                st.divider()
                st.subheader("üìà ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (Top 50)")
                df = pd.DataFrame(Counter(pairs).most_common(50), columns=['‡πÄ‡∏•‡∏Ç‡∏ä‡∏∏‡∏î', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å'])
                st.dataframe(df, use_container_width=True)
        else:
            st.warning("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ AI ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì")

else:
    # ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô)
    st.title("üìà AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏∏‡πâ‡∏ô")
    st.info("‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö Real-time")
    # ... ‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏∏‡πâ‡∏ô‡πÄ‡∏î‡∏¥‡∏° ...
